"""
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ACCESS LOGGER - Logger Especializado para Accesos
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Registra todos los accesos a rutas comunes del honeypot.

MEJORA CRรTICA #3: Logging de Accesos
- Registra path, user-agent, IP, perfil activo
- Formato estructurado para anรกlisis posterior
- Timestamps precisos
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
"""

import logging
from datetime import datetime


class AccessLogger:
    """
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ LOGGER ESPECIALIZADO PARA ACCESOS AL PERFIL COMรN                       โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
    โ QUร HACE: Registra accesos a rutas comunes del honeypot                 โ
    โ                                                                          โ
    โ INFORMACIรN QUE REGISTRA:                                                โ
    โ   - Timestamp preciso                                                   โ
    โ   - Path solicitado                                                     โ
    โ   - User-Agent del atacante                                             โ
    โ   - IP de origen                                                        โ
    โ   - Perfil activo del honeypot                                          โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    """
    
    @staticmethod
    def log_common_access(path: str, user_agent: str = None, 
                         ip_address: str = None, profile: str = None) -> dict:
        """
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ REGISTRAR ACCESO A RUTA COMรN                                       โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
        โ PARรMETROS:                                                          โ
        โ   path: Ruta solicitada (ej: "/robots.txt")                         โ
        โ   user_agent: User-Agent HTTP (puede ser None)                      โ
        โ   ip_address: IP del cliente (puede ser None)                       โ
        โ   profile: Perfil activo (ej: "wordpress", "api")                   โ
        โ                                                                      โ
        โ RETORNA: Diccionario con datos del log (para anรกlisis)              โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        """
        # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        # โ PASO 1: Generar timestamp preciso                               โ
        # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        
        # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        # โ PASO 2: Construir entrada de log estructurada                   โ
        # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        log_entry = {
            'timestamp': timestamp,
            'type': 'COMMON_ACCESS',
            'path': path,
            'user_agent': user_agent or 'Unknown',
            'ip': ip_address or 'Unknown',
            'profile': profile or 'all',
        }
        
        # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        # โ PASO 3: Escribir al log                                         โ
        # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
        # โ Formato: [COMMON] IP โ path | Profile: X | UA: Y                โ
        # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        log_message = (
            f"[COMMON] {log_entry['ip']} โ {log_entry['path']} | "
            f"Profile: {log_entry['profile']} | "
            f"UA: {log_entry['user_agent']}"
        )
        
        logging.info(log_message)
        
        # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        # โ PASO 4: Retornar datos para anรกlisis posterior                  โ
        # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        return log_entry
    
    @staticmethod
    def log_easter_egg_access(path: str, user_agent: str = None, 
                              ip_address: str = None) -> dict:
        """
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ REGISTRAR ACCESO A EASTER EGG (OJO DE ALUCARD)                      โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
        โ Logging especial para cuando alguien encuentra el ojo de Alucard    โ
        โ Esto es IMPORTANTE - significa que estรกn explorando a fondo         โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        """
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        
        log_entry = {
            'timestamp': timestamp,
            'type': 'EASTER_EGG',
            'path': path,
            'user_agent': user_agent or 'Unknown',
            'ip': ip_address or 'Unknown',
            'alert_level': 'HIGH',  # Alerta alta - encontraron algo oculto
        }
        
        # Log con nivel WARNING para destacar
        log_message = (
            f"[๐ด EASTER EGG] {log_entry['ip']} found hidden path: {log_entry['path']} | "
            f"UA: {log_entry['user_agent']}"
        )
        
        logging.warning(log_message)
        
        return log_entry
